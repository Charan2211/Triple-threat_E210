<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Dashboard - AI Business Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --light-bg: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            margin: 5px 0;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .dashboard-card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
            margin-bottom: 20px;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            color: white;
        }
        .quick-action-btn {
            background: var(--light-bg);
            border: 2px dashed #ddd;
            color: var(--primary-color);
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .quick-action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--warning-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ai-suggestion {
            border-left: 4px solid var(--success-color);
            background: rgba(76, 201, 240, 0.1);
            padding: 15px;
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 col-lg-2 d-md-block sidebar collapse p-0">
                <div class="position-sticky pt-3">
                    <div class="text-center p-4">
                        <h4><i class="fas fa-robot me-2"></i>AI Business Assistant</h4>
                        <small class="text-light">Small Business Platform</small>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="advertising.html">
                                <i class="fas fa-bullhorn me-2"></i>Advertising
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="content-studio.html">
                                <i class="fas fa-pencil-alt me-2"></i>Content Studio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="fundraising-hub.html">
                                <i class="fas fa-hand-holding-usd me-2"></i>Fundraising
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="collaboration-board.html">
                                <i class="fas fa-handshake me-2"></i>Collaboration
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="ai-assistant.html">
                                <i class="fas fa-robot me-2"></i>AI Assistant
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-chart-line me-2"></i>Analytics
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a>
                        </li>
                    </ul>
                    
                    <div class="mt-5 p-3">
                        <div class="card bg-dark text-white">
                            <div class="card-body">
                                <h6><i class="fas fa-lightbulb me-2"></i>Quick Tip</h6>
                                <small id="ai-tip">Schedule your social media posts for the week to save time.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 col-lg-10 ms-sm-auto px-4 py-4">
                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-1">Business Dashboard</h2>
                        <p class="text-muted" id="welcome-message">Welcome back! Here's your business overview.</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="position-relative me-3">
                            <button class="btn btn-outline-primary position-relative">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge">3</span>
                            </button>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-store me-2"></i>My Business
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="loadProfile()">Business Profile</a></li>
                                <li><a class="dropdown-item" href="#" onclick="loadSettings()">Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card dashboard-card stat-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-light">Active Campaigns</h6>
                                        <h2 id="active-campaigns">0</h2>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-bullhorn fa-2x"></i>
                                    </div>
                                </div>
                                <small class="text-light">This month</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card dashboard-card" style="background: linear-gradient(135deg, #7209b7, #3a0ca3); color: white;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-light">Content Scheduled</h6>
                                        <h2 id="scheduled-content">0</h2>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-calendar-alt fa-2x"></i>
                                    </div>
                                </div>
                                <small class="text-light">Next 7 days</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card dashboard-card" style="background: linear-gradient(135deg, #f72585, #b5179e); color: white;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-light">Budget Used</h6>
                                        <h2 id="budget-used">$0</h2>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-dollar-sign fa-2x"></i>
                                    </div>
                                </div>
                                <small class="text-light">Of $<span id="total-budget">0</span></small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card dashboard-card" style="background: linear-gradient(135deg, #4cc9f0, #4895ef); color: white;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-light">AI Suggestions</h6>
                                        <h2 id="ai-suggestions">0</h2>
                                    </div>
                                    <div class="align-self-center">
                                        <i class="fas fa-robot fa-2x"></i>
                                    </div>
                                </div>
                                <small class="text-light">Pending actions</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card dashboard-card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="fas fa-bolt me-2 text-warning"></i>Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3 mb-3">
                                        <div class="quick-action-btn" onclick="createCampaign()">
                                            <i class="fas fa-plus-circle fa-2x mb-2"></i>
                                            <h6>New Ad Campaign</h6>
                                            <small>Start advertising</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="quick-action-btn" onclick="scheduleContent()">
                                            <i class="fas fa-calendar-plus fa-2x mb-2"></i>
                                            <h6>Schedule Content</h6>
                                            <small>Plan social posts</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="quick-action-btn" onclick="createPitch()">
                                            <i class="fas fa-file-invoice-dollar fa-2x mb-2"></i>
                                            <h6>Create Pitch</h6>
                                            <small>Fundraising</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="quick-action-btn" onclick="findCollaborators()">
                                            <i class="fas fa-users fa-2x mb-2"></i>
                                            <h6>Find Partners</h6>
                                            <small>Collaboration</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Recommendations & Recent Activity -->
                <div class="row">
                    <!-- AI Recommendations -->
                    <div class="col-md-6">
                        <div class="card dashboard-card h-100">
                            <div class="card-header bg-white d-flex justify-content-between">
                                <h5 class="mb-0"><i class="fas fa-robot me-2 text-primary"></i>AI Recommendations</h5>
                                <button class="btn btn-sm btn-primary" onclick="loadAIRecommendations()">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="card-body" id="ai-recommendations">
                                <div class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-2">Loading recommendations...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="col-md-6">
                        <div class="card dashboard-card h-100">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="fas fa-history me-2 text-success"></i>Recent Activity</h5>
                            </div>
                            <div class="card-body">
                                <div class="list-group list-group-flush" id="recent-activity">
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <small class="text-muted">No recent activity</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Chart -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card dashboard-card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0"><i class="fas fa-chart-line me-2 text-info"></i>Performance Overview</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="performanceChart" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Create Campaign Modal -->
    <div class="modal fade" id="createCampaignModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Campaign</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="campaignForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Campaign Name</label>
                                <input type="text" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Platform</label>
                                <select class="form-select" required>
                                    <option value="">Select platform</option>
                                    <option value="facebook">Facebook</option>
                                    <option value="instagram">Instagram</option>
                                    <option value="google">Google Ads</option>
                                    <option value="linkedin">LinkedIn</option>
                                    <option value="twitter">Twitter</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Budget ($)</label>
                            <input type="number" class="form-control" min="50" step="10" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Target Audience</label>
                            <textarea class="form-control" rows="3" placeholder="Describe your target audience..."></textarea>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-outline-primary" onclick="generateAICopy()">
                                <i class="fas fa-robot me-2"></i>Generate with AI
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitCampaign()">Create Campaign</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentVendorId = 1; // In production, get from authentication
        let performanceChart;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            loadAIRecommendations();
            loadRecentActivity();
            initializeChart();
            setInterval(loadDashboardData, 30000); // Refresh every 30 seconds
        });

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch(`/api/analytics/dashboard/${currentVendorId}`);
                const data = await response.json();
                
                if (data.success) {
                    updateDashboardStats(data.dashboard);
                    updateRecentActivity(data.dashboard);
                    updateChart(data.dashboard);
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats(dashboard) {
            document.getElementById('active-campaigns').textContent = dashboard.metrics.total_campaigns;
            document.getElementById('scheduled-content').textContent = dashboard.metrics.total_content;
            document.getElementById('ai-suggestions').textContent = dashboard.metrics.pending_actions;
            
            // Calculate budget used
            const totalBudget = dashboard.profile.budget || 0;
            const budgetUsed = (dashboard.metrics.budget_utilization / 100) * totalBudget;
            
            document.getElementById('total-budget').textContent = totalBudget;
            document.getElementById('budget-used').textContent = '$' + budgetUsed.toFixed(0);
            
            // Update welcome message
            const welcomeMsg = document.getElementById('welcome-message');
            welcomeMsg.textContent = `Welcome back, ${dashboard.profile.business_name}!`;
        }

        // Load AI recommendations
        async function loadAIRecommendations() {
            try {
                const response = await fetch(`/api/ai/recommendations/${currentVendorId}`);
                const data = await response.json();
                
                const container = document.getElementById('ai-recommendations');
                container.innerHTML = '';
                
                if (data.success && data.recommendations) {
                    // Display recommendations
                    for (const [category, items] of Object.entries(data.recommendations)) {
                        if (Array.isArray(items)) {
                            items.slice(0, 2).forEach(item => {
                                const recElement = document.createElement('div');
                                recElement.className = 'ai-suggestion mb-3';
                                recElement.innerHTML = `
                                    <div class="d-flex justify-content-between">
                                        <strong class="text-primary">${category.toUpperCase()}</strong>
                                        <small class="text-muted">${item.priority || 'Medium'} priority</small>
                                    </div>
                                    <p class="mb-1">${item.description}</p>
                                    <div class="mt-2">
                                        ${(item.actions || []).map(action => 
                                            `<span class="badge bg-light text-dark me-1">${action}</span>`
                                        ).join('')}
                                    </div>
                                `;
                                container.appendChild(recElement);
                            });
                        }
                    }
                    
                    if (container.children.length === 0) {
                        container.innerHTML = '<p class="text-muted text-center">No recommendations at this time.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading AI recommendations:', error);
            }
        }

        // Load recent activity
        async function loadRecentActivity() {
            try {
                const response = await fetch(`/api/analytics/activity/${currentVendorId}`);
                const data = await response.json();
                
                const container = document.getElementById('recent-activity');
                if (data.success && data.activities.length > 0) {
                    container.innerHTML = '';
                    data.activities.forEach(activity => {
                        const activityElement = document.createElement('div');
                        activityElement.className = 'list-group-item';
                        activityElement.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${activity.title}</h6>
                                <small class="text-muted">${activity.time}</small>
                            </div>
                            <p class="mb-1">${activity.description}</p>
                            <small class="text-muted">${activity.type}</small>
                        `;
                        container.appendChild(activityElement);
                    });
                }
            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }

        // Update recent activity from dashboard data
        function updateRecentActivity(dashboard) {
            const container = document.getElementById('recent-activity');
            const activities = [];
            
            // Add campaigns as activities
            dashboard.campaigns.forEach(campaign => {
                activities.push({
                    title: campaign.campaign_name,
                    description: `New ${campaign.platform} campaign`,
                    time: 'Recently',
                    type: 'Advertising'
                });
            });
            
            // Add content as activities
            dashboard.content.slice(0, 3).forEach(content => {
                activities.push({
                    title: content.title,
                    description: `Scheduled for ${content.platform}`,
                    time: content.scheduled_time,
                    type: 'Content'
                });
            });
            
            // Update UI
            container.innerHTML = '';
            activities.forEach(activity => {
                const activityElement = document.createElement('div');
                activityElement.className = 'list-group-item';
                activityElement.innerHTML = `
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${activity.title}</h6>
                        <small class="text-muted">${activity.time}</small>
                    </div>
                    <p class="mb-1">${activity.description}</p>
                    <small class="text-muted">${activity.type}</small>
                `;
                container.appendChild(activityElement);
            });
        }

        // Initialize performance chart
        function initializeChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Impressions',
                        data: [1200, 1900, 1500, 2500],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Engagement',
                        data: [300, 500, 400, 700],
                        borderColor: '#4cc9f0',
                        backgroundColor: 'rgba(76, 201, 240, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Update chart with real data
        function updateChart(dashboard) {
            // This would update chart with real performance data
            // For now, we'll simulate data
            const newData = {
                impressions: [
                    Math.floor(Math.random() * 2000) + 1000,
                    Math.floor(Math.random() * 2000) + 1000,
                    Math.floor(Math.random() * 2000) + 1000,
                    Math.floor(Math.random() * 2000) + 1000
                ],
                engagement: [
                    Math.floor(Math.random() * 800) + 200,
                    Math.floor(Math.random() * 800) + 200,
                    Math.floor(Math.random() * 800) + 200,
                    Math.floor(Math.random() * 800) + 200
                ]
            };
            
            performanceChart.data.datasets[0].data = newData.impressions;
            performanceChart.data.datasets[1].data = newData.engagement;
            performanceChart.update();
        }

        // Quick action functions
        function createCampaign() {
            const modal = new bootstrap.Modal(document.getElementById('createCampaignModal'));
            modal.show();
        }

        async function submitCampaign() {
            const form = document.getElementById('campaignForm');
            const formData = new FormData(form);
            
            const campaignData = {
                campaign_name: formData.get('campaignName'),
                platform: formData.get('platform'),
                budget: parseFloat(formData.get('budget')),
                target_audience: formData.get('targetAudience')
            };
            
            try {
                const response = await fetch('/api/advertising/campaign/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        vendor_id: currentVendorId,
                        campaign_data: campaignData
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('Campaign created successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('createCampaignModal')).hide();
                    loadDashboardData();
                }
            } catch (error) {
                console.error('Error creating campaign:', error);
                alert('Failed to create campaign');
            }
        }

        function generateAICopy() {
            // Implement AI copy generation
            alert('AI copy generation would be implemented here');
        }

        function scheduleContent() {
            window.location.href = 'content-studio.html';
        }

        function createPitch() {
            window.location.href = 'fundraising-hub.html';
        }

        function findCollaborators() {
            window.location.href = 'collaboration-board.html';
        }

        function loadProfile() {
            // Load business profile
            alert('Loading business profile...');
        }

        function loadSettings() {
            // Load settings
            alert('Loading settings...');
        }

        function logout() {
            // Implement logout
            alert('Logging out...');
            window.location.href = '/';
        }

        // Update AI tip periodically
        const tips = [
            "Schedule your social media posts for the week to save time.",
            "Use AI to generate ad copy that converts better.",
            "Check your campaign performance daily for quick optimizations.",
            "Collaborate with complementary businesses for mutual growth.",
            "Set aside 10% of your budget for testing new advertising platforms."
        ];
        
        setInterval(() => {
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            document.getElementById('ai-tip').textContent = randomTip;
        }, 15000);
    </script>
</body>
</html>